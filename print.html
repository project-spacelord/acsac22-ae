<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Spacelord Artifact Evaluation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Preparation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hub.html"><strong aria-hidden="true">1.1.</strong> Hub Image</a></li><li class="chapter-item expanded "><a href="user-token.html"><strong aria-hidden="true">1.2.</strong> User token & OS image</a></li><li class="chapter-item expanded "><a href="esp32.html"><strong aria-hidden="true">1.3.</strong> ESP32 Peripheral</a></li><li class="chapter-item expanded "><a href="server.html"><strong aria-hidden="true">1.4.</strong> Web Server</a></li></ol></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">2.</strong> Testing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Spacelord Artifact Evaluation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This repository contains artifact evaluation guide for
ACSAC'22 submission
<em>SPACELORD: Private and Secure Smart Space Sharing</em>.</p>
<p>The Spacelord artifact submission consists of four components:</p>
<ol>
<li>Hub image
<ul>
<li>This is a disk image uploaded to the board.
It contains Spacelord bootloader, image downloader,
and the signature generator.</li>
</ul>
</li>
<li>User token and OS image
<ul>
<li>User token communicates with Spacelord bootloader to upload user image
after verifying the identity of the hub.</li>
<li>We provide reference implementation of user token as a Linux userspace program.</li>
</ul>
</li>
<li>Peripheral image
<ul>
<li>Reference implementation of Spacelord protocol on ESP32-based camera device.</li>
</ul>
</li>
<li>Web server
<ul>
<li>A web server that stores encrypted user files.</li>
</ul>
</li>
</ol>
<p>Artifacts can be downloaded at this <a href="https://1drv.ms/u/s!Apa8Zxdex5yci51ALONC_FURN_GnNw?e=No9NnK">OneDrive link</a>.</p>
<p>TODO: make this link read-only</p>
<p>TODO: mention paper chapters for each component</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hub-image"><a class="header" href="#hub-image">Hub Image</a></h1>
<ul>
<li>RockPro64: <code>hub-images/rockpro64-downloader.img</code></li>
<li>iMX8MQ: <code>hub-images/imx8mq-evk-downloader.img</code></li>
<li>QEMU (for artifact evaluation without hardware): <code>hub-images/qemu-downloader.img</code></li>
</ul>
<p>For hardware based evaluation,
the target board, an NVME SSD, and an eMMC card are required.
Download the corresponding hub image
and upload the image to the eMMC card with a disk flashing tool
(e.g., Etcher, dd - <a href="https://wiki.radxa.com/Rockpi4/install/eMMC">example</a>).</p>
<p>To minimize the hardware requirement,
we disabled TPM requirement for RockPro64 hub image.
TPM requirement do not affect the system performance
because TPM is only used to store secret keys at the boot stage.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-token"><a class="header" href="#user-token">User Token</a></h1>
<p>User token verifies the current status of Spacelord hub
and hands over space configuration
and user secrets (e.g., LUKS password)
once the hub's identity and the integrity are verified.</p>
<p>User token can be downloaded at <code>token</code>
which is a static Linux binary.
Please add the execution permission (<code>chmod +x ./token</code>) after downloading it.</p>
<h2 id="user-os-image"><a class="header" href="#user-os-image">User OS Image</a></h2>
<p>Spacelord compatible user OS images establish a connection with the user token after booting the kernel.
After the identity and the integrity of the board is confirmed by the user token,
the user token sends over the user secrets that are required to decrypt the user layer.</p>
<p>Sample user OS image for each board can be downloaded at the following locations.
Decompress the downloaded image <strong>and keep the original <code>.lz4</code> file</strong>.</p>
<ul>
<li>RockPro64: <code>os-images/rockPro64-user.img.lz4</code></li>
<li>iMX8MQ: <code>os-images/imx8mq-evk-user.img.lz4</code></li>
<li>QEMU (for artifact evaluation without hardware): <code>hub_images/qemu-user.img.lz4</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="esp32-peripheral"><a class="header" href="#esp32-peripheral">ESP32 Peripheral</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-setup"><a class="header" href="#server-setup">Server Setup</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<h2 id="functionality-testing"><a class="header" href="#functionality-testing">Functionality Testing</a></h2>
<p>Make sure you have downloaded artifacts listed in the <a href="/introduction.html">Introduction</a>.</p>
<p>TODO: provide downloader script</p>
<ol>
<li>Boot the board
<ul>
<li>Connect the board to the ethernet and turn it on.
The board will boot into the hub manager
and print a message:
<code>Please connect to &lt;your_ip&gt;</code></li>
<li>For QEMU-based testing,
use script XXX.
TODO: provide QEMU launch script.</li>
</ul>
</li>
<li>Run user token
<ul>
<li>Run user token with the following command:
<code>./token &lt;printed_ip&gt; &lt;expected_os_image&gt;</code></li>
<li>User token reads configuration from <code>config.toml</code> file.
TODO: Should we ask reviewers to run their own server?</li>
<li>The token program connects to the hub manager
(port number 15758)
and informs it where it can download the base image (system + hardware layer).
It also chooses a nonce for this session.
<ul>
<li>This configuration comes from <code>IMAGE_SERVER_URL</code> field.</li>
</ul>
</li>
</ul>
</li>
<li>Authenticated boot
<ul>
<li>The hub manager downloads the base image and reboots into the bootloader.
The bootloader calculates the hash of the downloaded image
and generates a certificate based on the measurement result and the nonce.</li>
<li>Concurrently, the token program calculates the expected hash.</li>
<li>When the both parts finishes their work,
the board boots into the device image and runs the agent application
that performs authenticated key exchange with the user token.
The reference implementation uses TLS handshake with client auth (port number 15759).</li>
<li>If the authentication succeeds,
the user token sends user credentials that are necessary to mount the user layer.</li>
</ul>
</li>
<li>User layer mount
<ul>
<li>As the last step, the user layer is mounted and the board is ready to be used.</li>
</ul>
</li>
</ol>
<p>TODO: Config migration - @Marcus?</p>
<h2 id="performance-testing"><a class="header" href="#performance-testing">Performance Testing</a></h2>
<p>TODO: @Sabartha</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
